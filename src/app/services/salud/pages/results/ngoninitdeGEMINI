


            this.dialogService2.detailsVisible$.subscribe((value) => {
          console.log("Valor actual de detailsVisible$: ", value);
          this.detailsVisible = value; // Asigna el valor a una propiedad del componente
        });




    if (!formData && !cachedProducts) {
      this.dataFormularios.setFormularioData(this.formDataInicial.value);
      formData = this.dataFormularios.getFormularioDataValue();
    } else if (!formData && cachedProducts) {

     this.productoService.setProductosFiltrados(cachedProducts);
    }

this.formularioSubscription = this.dataFormularios.formularioData$.subscribe(formData => {

    if (formData) {
      this.cotizacionService.getPrecios(formData).subscribe(
        (response: Planes) => {
          const tipo: string = formData.tipo;
          this.products = response;
          setTimeout(() => {

            caches.open("products").then((cache) => {
              console.log("results 890 JSON.stringify(this.productosFiltrados)")

              const productosResponse = new Response(
                JSON.stringify(this.productosFiltrados)
              );
              cache
                .put("productos", productosResponse)
                .then(() => {
                  console.log(" 898 Productos almacenados en caché:", productosResponse);
                })
                .catch((cacheError) => {
                  console.error("901 Error al almacenar en caché:", cacheError);
                });
            });
console.log(' 904   this.products.resultado 785',this.products.resultado)
            // Actualizar la vista con los productos
            this.compareProdList();
            this.onItemSelect(this.selectedClinica);
          }, 0);
        },
        (error: any) => {
          console.error("Error en la solicitud de precios:", error);
        }
      );
    }
  });





  // Observadores y configuraciones adicionales (TODAS ASIGNADAS)
    this.sortbySubscription = this.SortbyParamControl.valueChanges.subscribe((selectedValue: string) => {
        // console.log(" 918 Nuevo valor seleccionado:", selectedValue);
    });

    this.empresaSubscription = this.empresa.valueChanges.subscribe((selectedValue: string) => {
        // console.log(" 922 Valor seleccionado de la empresa:", selectedValue);
    });



    this.filterClinicasSubscription = this.productoService.eventoFilterClinicas$.subscribe(() => {
        // console.log(" 931 this.productosFiltrados = filteredProducts;");
        this.productosFiltrados = this.filtrarPorClinicasExistente(
            this.productosFiltrados,
            this.selectedClinica
        );
    });

    this.productosFiltradosSubscription = this.productoService.productosFiltrados$.subscribe((productos: any[]) => {
        console.log(" 1017 this.productosFiltrados = filteredProducts;");
         console.log("prodeictos 1018 ",productos);
        this.products = productos;
        this.productosFiltrados = this.products;
    });
    
    


    setTimeout(() => {
      this.isLoaded = true;
    }, 4000);

    console.log("this.productosFiltrados 1036",this.productosFiltrados)
    if (!this.productosFiltrados) {
      this.productosFiltrados = this.products;
    }
 console.log("this.productosFiltrados 1040",this.productosFiltrados)



    this.compareProdList();
    this.onItemSelect(this.selectedClinica);

    

    // this.breakpointObserver
    //   .observe([Breakpoints.Handset, Breakpoints.Tablet])
    //   .subscribe((result) => {
    //     this.isSmallScreen = result.matches;
    //   });
  }